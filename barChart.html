<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>歷年監獄受刑人人數</title>
	<link rel="stylesheet" type="text/css" href="../libs/bootstrap/css/bootstrap.min.css">
	<style type="text/css" href="./style/reset.css"></style>
	<style type="text/css">
		html, body { height: 100%; width: 100%; margin: 0px; }
		/*body { background-color: #F7F9F9; }*/
		#PANEL { 
			height: 100%; 
			/*background-image: url('../Visual Design/elements/JusticeVisualizingLOGO_1_w300.png');*/
			/*background-size: contain;*/
			background-position: 50% 50%;
			background-repeat: no-repeat;
			/*background-size: #f7f9f9;*/
		}
		#DISPLAY_PANEL, #CRTL_PANEL { display: inline-block; }
		#DISPLAY_PANEL { height: 100%; }
		#CRTL_PANEL { height: 100%; position: relative; }
		#OPTSCHART { position: absolute; top: 10%; }
		#OPTS { position: absolute; top: 30%; }
		#OPTS fieldset { display:block; margin: 0px auto; border: 0px; }
		#OPTS fieldset legend { font-size: 1.2em; }
		#OPTS fieldset label { display: block; font-weight: 400; }
		#SUBOPTS { position: absolute; top: 60%; }
		#SUBOPTS label { display: block; }
		/* Left the padding for axes */
		/*#SKETCHPAD { padding-top: 10%; padding-left: 5%; padding-bottom: 5%; }*/
		.mark { font-family: sans-serif; font-size: 0.8em; fill: #fff; }
		.x-axis path { fill: none; }
		.x-axis .axis-name,
		.y-axis .axis-name { font-size: 0.95em; font-family: sans-serif; }
		.x-axis path { fill: none; stroke: #909090; }
		.y-axis path { fill: none; stroke: #f1f1f1; }
		.x-axis .tick text,
		.y-axis .tick text { font-size: 0.95em;font-family: monospace; }

		.tip {
			display: none;
			position: absolute;
			/*width: 100px;*/
			padding: 5px;
			background-color: #333;
			color: #fff;
			line-height: 1.5;
			font-size: 14px;
		}
		.tip::after, .tip::before { 
			box-sizing: border-box;
			position: absolute; 
			color: #333;
			font-size: 16px;
			width: 100%;
			left: 49%;
			line-height: 0.6;

		}

		.tip::before { 
			display: none;
			content: "\25B2";
			top: -9px; 
		}

		.tip::after { 
			display: none;
			content: "\25BC";
			top: 100%; 
		}

		.tip-after-display::after, 
		.tip-before-display::before { display: block; }

		.tip-after-none::after, 
		.tip-before-none::before { display: none; }


		.tip.display { display: inline-block; }
		.tip, .tip:after { opacity: 0.8; }

	</style>
	<script type="text/javascript" src="./libs/d3.js" charset="utf-8"></script>
	<script type="text/javascript" src="./libs/jquery-2.1.4.min.js" charset="utf-8"></script>
	<script type="text/javascript" src="./scripts/vjtw.js"></script>

</head>
<body class="container-fluid">
	<div id="PANEL" class="row">
		<div id="DISPLAY_PANEL" class="col-md-10"></div>
		<div id="CRTL_PANEL" class="col-md-2">
			<form id="OPTSCHART">
				<label style="display: block;">
					<input id="OPTBARCHRT" type="radio" name="charttype" 
						   onclick="
							if ( this.checked ) {
								prepareBarChrt();
								
								barGraph.beVisible();
								lineGraph.hide();
								lineGraph.hideUnderArea();
							}
							" checked> 
					<span>長條圖</span> 
				</label>
				<label style="display: block;">
					<input id="OPTLINECHRT" type="radio" name="charttype" 
						   onclick="
						   if ( this.checked ) {
						   		prepareBarChrt();
								lineGraph.beDisplayed();
								lineGraph.hideUnderArea();
								barGraph.hide();
						   }
						   
						    "> 
					<span>折線圖</span>
				</label>
				<label style="display: block;">
					<input id="AREAOPT" type="radio" name="charttype" 
					onclick="
						if ( this.checked ) {
							prepareBarChrt();
							
							
							lineGraph.displayUnderArea();
							lineGraph.hide();
							barGraph.hide();
						}
						
					">
					<span>面積圖</span>
				</label>
			</form>
			<form id="OPTS">
				<fieldset>
					<legend>監獄人數概況</legend>
					<label>
						<input 
							type="radio" name="prisonDataOption" 
							value="本年執行人數" 
							id="OPT1"
							onclick= 
							"
							prepareBarChrt();
							updateChrt('/correction/監獄人數概況.csv', '民國', '人數(仟人)', '本年執行人數');

							 "
						 	}

							}
							
							checked><span>本年執行人數</span>
						</label>
					<label>
					<label>
						<input 
							type="radio" name="prisonDataOption" 
							value="本年入監人數" 
							id="OPT2"
							onclick=
							"
							prepareBarChrt();
							updateChrt('/correction/監獄人數概況.csv', '民國', '人數(仟人)', '本年入監人數');

							 	">
							<span>本年入監人數</span>
						</label>
					<label>
						<input 
							type="radio" name="prisonDataOption" 
							value="新入監人數"
							id="OPT3"
							onclick=
							"
							prepareBarChrt();
							updateChrt('/correction/監獄人數概況.csv', '民國', '人數(仟人)', '新入監人數');">
							<span>新入監人數</span>
						</label>
					<label>
						<input 
							type="radio" name="prisonDataOption" 
							value="本年出獄人數"
							id="OPT4"
							onclick=
							"
							prepareBarChrt();
							updateChrt('/correction/監獄人數概況.csv', '民國', '人數(仟人)', '本年出獄人數');">
								<span>本年出獄人數</span>
						</label>
					<label>
						<input 
							type="radio" name="prisonDataOption" 
							value="本年年底留監人數"
							id="OPT5"
							onclick=
							"
							prepareBarChrt();
							updateChrt('/correction/監獄人數概況.csv', '民國', '人數(仟人)', '本年年底留監人數');
							">
							<span>本年年底留監人數</span>
						</label>
				</fieldset>
			</form>
			<form id="SUBOPTS">
				<label>
					<input type="radio" name="suboption" id="SUBOPT1" checked>
						<span>總數</span>
				</label>
				<label>
					<input type="radio" name="suboption" id="SUBOPT2">
						<span>上年留監與年底在監人數</span>
				</label>
			</form>
		</div>
	</div>
	</div>
	<script type="text/javascript" src="../libs/jquery-2.1.4.min.js"></script>
	<script type="text/javascript">

		// Add event listers to options
		var opts = [ 
			{
				'#OPT1': ['總數', '上年底留監人數與在監人數']
			}, 
			{
				'#OPT2': ['總數']
			}, 
			{
				'#OPT3': ['總數', '教育程度', '犯罪次數與種類', '家庭狀況']
			}, 
			{
				'#OPT4': ['總數']
			}, 
			{
				'#OPT5': ['總數']
			}];

		(function() {

			var subOptsForm = 
					document.getElementById('SUBOPTS');

			for ( var i = 0; i < opts.length ; ++i ) {

				var optId = "#OPT" + (i+1);

				$(optId).on('click', function() {

					// Clear all old suboptions.
					$(subOptsForm).empty();

					// 
					var selectedSubOpts = (function(option) {

						var idSelector = '#' + option.id;

						for ( var j=0; j<opts.length; ++j )

							if (opts[j][idSelector])
								return {
							 		items: opts[j][idSelector]
								}
					})(this);


					for ( var k in selectedSubOpts.items ) {

						var subOptId = "SUBOPT" + (parseInt(k)+1),
							label = document.createElement('label'),
							radio = document.createElement('input'),
							span = document.createElement('span');

						radio.id = subOptId;
						radio.name = 'suboption';
						radio.type = 'radio';

						if ( k === '0' ) radio.checked = true;

						span.innerHTML = selectedSubOpts.items[k];

						label.appendChild(radio);
						label.appendChild(span);
						
						subOptsForm.appendChild(label);

					}
				});
			}

				

		})();


		var barGraph = new barGraphClass(),
			lineGraph = new lineGraphClass(),
			tip = new tipClass();

			barGraph.initializeAPad();
			barGraph.setChartSize();
			barGraph.setOutPadding(10);
			barGraph.setStep(10);
			barGraph.drawingData('/correction/監獄人數概況.csv', '民國', '人數(仟人)', '本年執行人數')
				.then(function(jsonOutput) {

					lineGraph.inheritPad(
						barGraph.pad, 
						barGraph.padHeight, 
						barGraph.padWidth, 
						barGraph.padPadding);

					lineGraph.setChartSize();

					lineGraph.plotBars(
						jsonOutput.data,
						jsonOutput.pad, 
						null,
						jsonOutput.barWidth/2
						).then(function(o) {

							lineGraph.linePath = o.line;
							lineGraph.lineDots = o.dots; 
							lineGraph.areaUnderLine = o.area;

							whichDisplayed();

							tip.appendDotMouseOver('本年執行人數');
							tip.appendBarMouseOver('本年執行人數');
						});

			});

		function prepareBarChrt() {

			if (document.getElementById('OPTBARCHRT').checked)
				barGraph.beVisible();
			else barGraph.bePhantom();
		}

		function updateChrt(path, xLabel, yLabel, dOption) {

			barGraph
				.update(path, xLabel, yLabel, dOption)
					.then(function(jsonOutput) {

						lineGraph.plotBars(
							jsonOutput.data,
							jsonOutput.pad,
							jsonOutput.updatedBars, 
							jsonOutput.barWidth/2
						).then(function(o) {

							 lineGraph.linePath = o.line;
							 lineGraph.lineDots = o.dots;
							 lineGraph.areaUnderLine = o.area;

							 whichDisplayed();

							 tip.appendDotMouseOver(dOption);
							 tip.appendBarMouseOver(dOption);

							 });
					});

		}

		function whichDisplayed() {

			if (document.getElementById('OPTLINECHRT').checked) {
				barGraph.hide();
				lineGraph.beDisplayed();
				lineGraph.hideUnderArea();
			} else if (document.getElementById('OPTBARCHRT').checked) {
				barGraph.beVisible();
				lineGraph.hide();
				lineGraph.hideUnderArea();
			}
			else {
				barGraph.hide();
				lineGraph.hide();
				lineGraph.displayUnderArea();
			}			
		}



	</script>
</body>
</html>