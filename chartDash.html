<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<link rel="stylesheet" type="text/css" href="./libs/reset.css">
	<link rel="stylesheet" type="text/css" href="./libs/pureGrid.css">
	<script type="text/javascript" src="./libs/react-0.14.7.js"></script>
	<script type="text/javascript" src="./libs/react-dom-0.14.7.js"></script>
	<script type="text/javascript" src="./libs/JSXTransformer.js"></script>
	<script type="text/javascript" src="./libs/velocity.js"></script>
	<style type="text/css">
		#TopicToggle { cursor: pointer; }

		#ChartTypeList { display: none; }
	</style>
</head>
<body >
	<div id="CONTAINER">

	</div>
	<script type="text/jsx">

		var Aside = React.createClass({
			render: function() {
				return (
					<aside>
						<TopicSelection />
						<ChartTypeSelection />
					</aside>
				)
			}
		});

		/* Topic Side is a control panel for users to view data of different topic in a theme */
		var TopicSelection = React.createClass({

			getInitialState: function() {
				return {
					topics: [
						{
							name: '本年執行人數',
							subTopics: [
								'總數'
							]
						},
						{
							name: '新入監人數',
							subTopics: [
								'總數'
							]
						},
						{
							name: '本年入監人數',
							subTopics: [
								'總數'

							]
						},
						{
							name: '本年出監人數',
							subTopics: [
								'總數'
							]
						},
						{
							name: '上年底留監人數',
							subTopics: [
								'總數'

							]
						},
						{
							name: '本年底留監人數',
							subTopics: [
								'總數'

							]
						}
					],
					// chartTypes: [
					// 	'長條圖',
					// 	'折線圖',
					// 	'面積圖'
					// ],
					currentTopicIndex: 0,
					currentTopicName: '本年執行人數',

					isTopicListDisplayed: true,
					// isChartTypeListDisplayed: false
				}
			},

			selectTopic: function(e) {
				console.log('#1 click topic option');
				console.log('======================================================');
				var childNodes = 
						e.target.parentNode.childNodes,
					l = childNodes.length,
					selectedIndex = null;

				// Find out the index of the chosen item
				for (var i=0; i<l; i++) {

					if (childNodes[i] === e.target) {
						selectedIndex = i;
						break;
					} 
				}

				this.setState({
					currentTopicIndex: selectedIndex,
					currentTopicName: this.state.topics[selectedIndex].name
				});
				console.log(this.state.isTopicListDisplayed);
			},

			// Press the toggle for showing the topics to choose
			displayTopicList: function(e) {
				console.log("Display Topic List");
				console.log(this.state.isTopicListDisplayed);
				this.setState({
					isTopicListDisplayed: !this.state.isTopicListDisplayed
				});
				console.log(this.state.isTopicListDisplayed);

				return "testing"
			},

			// displayChartTypeList: function(e) {
			// 	console.log("Display Chart Type List");
			// 	this.setState({
			// 		isChartTypeListDisplayed: !this.state.isChartTypeListDisplayed
			// 	});
			// },

			componentWillUpdate: function() {

				console.log('Here is Topic Side WillUpdate');
			},

			render: function() {
				console.log('======================================================');
				console.log('#2 Topic Side renders');
				console.log("this.state.isTopicListDisplayed:");
				console.log(this.state.isTopicListDisplayed);
				console.log("this.state.isChartTypeListDisplayed:");
				console.log(this.state.isChartTypeListDisplayed);
				console.log('======================================================');

				return (
					<div>
						<TopicSelectionBox 
							currentTopicIndex={ this.state.currentTopicIndex }
							currentTopic={ this.state.currentTopicName }
							isToggleOn={ this.state.isTopicListDisplayed }
							onPressToggle={ this.displayTopicList }/>
						<TopicList 
							isDisplayed={ this.state.isTopicListDisplayed }
							listItemsOnClick={ this.selectTopic }
							topics={ this.state.topics }
							currentTopicIndex={ this.state.currentTopicIndex } />
					</div>
				)
			}
		});

		// The UI is designed to allow user to switch topic 
		var TopicSelectionBox = React.createClass({

			componentWillUpdate: function() {
				// console.log('Topic Will Update');
			},

			render: function() {
				console.log(this.props.currentTopic);
				return (
					<div>
						<span>{ this.props.currentTopic }</span>
						<TopicSelectionToggle 
							isToggleOn={ this.props.isToggleOn }
							onPressToggle={ this.props.onPressToggle }/>
					</div>
				)
			}
		});

		var TopicSelectionToggle = React.createClass({

			getInitialState: function() {
				return {
					isToggleOn: true
				}
			},

			componentWillReceiveProps: function(nextProps) {
				console.log("Here is Topic Toggle WillReceiveProps");
				this.setState({
					isToggleOn: nextProps.isToggleOn
				});
			},

			componentWillUpdate: function() {
				console.log("Here is Topic Toggle WillUpdate");
			},

			render: function() {

				var toggleInfo = 
						this.state.isToggleOn ? 
							"Hide The List": "Show The List";

				return (
					<a id="TopicToggle" onClick={ this.props.onPressToggle }>
						{ toggleInfo }
					</a>
				)
			}
		});

		var TopicList = React.createClass({

			getInitialState: function() {

				return {
					selectedOptionIndex: 0,
					isDisplayed: true

				}
			},

			componentWillMount: function() {
				console.log('Here is Topic List WillMount');
				this.setState({
					isDisplayed: this.props.isDisplayed
				});

			},

			componentDidMount: function() {
				console.log('Here is Topic List DidMount');
				

			},

			componentWillReceiveProps: function(nextProps) {
				console.log('======================================================');
				console.log('#3 Here is Topic List WillReceiveProps');
				console.log(nextProps.isDisplayed);

				// The setting will be valid after component is updated successfully.
				this.setState({
					isDisplayed: nextProps.isDisplayed
				});
				console.log(this.state.isDisplayed);
				console.log('======================================================');
			},

			componentWillUpdate: function(nextProps) {
				console.log('======================================================');
				console.log('#4 Here is Topic List WillUpdate');
				console.log('this.state.isDisplayed:');
				console.log(this.state.isDisplayed);
				console.log('nextProps.isDisplayed:');
				console.log(nextProps.isDisplayed);
				console.log('======================================================');
				var node = ReactDOM.findDOMNode(this);

				// Check the isDisplayed property is true or false
				if (!nextProps.isDisplayed) 
					Velocity(node, {opacity: 0}, {display: 'none'});
				else Velocity(node, {opacity: 1}, {display: 'inline-block'});
			},

			// componentDidUpdate: function() {
			// 	console.log('Here is topic list DidUpdate');
			// 	this.setState({ isDisplayed: this.props.isDisplayed });
			// },

			render: function() {
				console.log('======================================================');
				console.log("#5 Render the TopicList");
				console.log(this.state.isDisplayed);
				console.log('======================================================');
				var topicOptions = [],
					l = this.props.topics.length;

				for ( var i=0; i<l; i++ ) {

					var isSelected =  
							this.props.currentTopicIndex === i? 
								true: false;

					topicOptions
						.push(
						<TopicOption key={i} 
							topicName={this.props.topics[i].name} 
							isSelected={isSelected} 
							itemOnClick={this.props.listItemsOnClick} />
					);
				}
				
				return (
					<ul id="TopicList">
						{ topicOptions }n
					</ul>
				)
				
			}
		});

		var TopicOption = React.createClass({

			render: function() {

				var currentTopic = this.props.isSelected ? "currentTopic" : "";

				return (
					<li className={currentTopic} onClick={this.props.itemOnClick}>
						{ this.props.topicName }
					</li>
				)
			}
		});

		// An UI for ChartType selection
		var ChartTypeSelection = React.createClass({

			getInitialState: function() {

				return {
					chartTypes: [
						'長條圖',
						'折線圖',
						'面積圖'
					],
					isChartTypeListDisplayed: false,
					selectedChartType: '長條圖'
				}
			},

			displayChartTypeList: function(e) {
				console.log("Display Chart Type List");
				this.setState({
					isChartTypeListDisplayed: !this.state.isChartTypeListDisplayed
				});
			},

			// Start the editing here. 20160205
			selectChartType: function(e) {

			},

			render: function() {
				return (
					<div>
						<ChartTypeSelectionBox 
							isToggleOn={ this.state.isChartTypeListDisplayed }
							onPressToggle={ this.displayChartTypeList } />
						<ChartTypeSelectionList 
							onClickListItem={ this.selectChartType }
							isDisplayed={ this.state.isChartTypeListDisplayed }
							chartTypes={ this.state.chartTypes } />
					</div>
				)
			}
		});

		// User can decides what kinds of chart they want to see.
		var ChartTypeSelectionBox = React.createClass({

			render: function() {
				return (
					<div>
						<span></span>
						<ChartTypeSelectionToggle 
							isToggleOn={this.props.isToggleOn}
							onPress={this.props.onPressToggle} />
					</div>
				)
			}
		});

		var ChartTypeSelectionToggle = React.createClass({

			getInitialState: function() {
				return { 
					isToggleOn: false
				}
			},

			componentWillReceiveProps: function(nextProps) {
				console.log(nextProps.isToggleOn);
				this.setState({
					isToggleOn: nextProps.isToggleOn
				});
			},

			render: function() {

				var textInfo = 
						this.state.isToggleOn ? 
							"Hide Available ChartTypes.": "Display Available ChartTypes.";

				return (
					<a onClick={this.props.onPress}>
						{ textInfo }
					</a>
				)
			}
		});

		var ChartTypeSelectionList = React.createClass({

			getInitialState: function() {
				return {
					isDisplayed: false
				}
			},

			componentWillReceiveProps: function(nextProps) {
				this.setState({
					isDisplayed: nextProps.isDisplayed
				});
			},

			componentWillUpdate: function(nextProps) {

				var node = ReactDOM.findDOMNode(this);

				if (!nextProps.isDisplayed) 
					Velocity(node, {opacity: 0}, {display: 'none'});
				else Velocity(node, {opacity: 1}, {display: 'inline-block'});

			},

			render: function() {

				var chartTypes = [];
					l = this.props.chartTypes.length;

				for (var i=0; i<l; i++)
					chartTypes.push(
						<ChartType 
							key={i} 
							onClickEvt={ this.props.onClickListItem } 
							typeName={ this.props.chartTypes[i] } />
					);

				return (
					<ul id="ChartTypeList">
						{ chartTypes }
					</ul>
				)
				
			}
		});

		var ChartType = React.createClass({
			render: function() {
				return (
					<li onClick>
						<span>{ this.props.typeName }</span>
					</li>
				)
			}
		});

		// var SubTopicSelectionBox = React.createClass({
		// 	render: function() {

		// 	}
		// });

		// var SubTopicList = React.createClass({
		// 	render: function() {

		// 	}
		// });

		// var SubTopic = React.createClass({
		// 	render: function() {

		// 	}
		// });
		ReactDOM.render(<Aside />, document.getElementById('CONTAINER'));
	</script>
</body>
</html>